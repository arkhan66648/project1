<!DOCTYPE html>
<html lang="en">
<head>
    <!-- SEO & METADATA -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{META_TITLE}}</title>
    <meta name="description" content="{{META_DESC}}">
    {{META_KEYWORDS}}
    <meta name="theme-color" content="{{THEME_META_COLOR}}">

    <!-- OPEN GRAPH & SOCIAL -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{CANONICAL_URL}}">
    <meta property="og:site_name" content="{{SITE_NAME}}">
    <meta property="og:title" content="{{META_TITLE}}">
    <meta property="og:description" content="{{META_DESC}}">
    <meta property="og:image" content="{{OG_IMAGE}}">
    <meta property="og:image:secure_url" content="{{OG_IMAGE}}">
    <meta property="og:image:type" content="{{OG_MIME}}">
    <meta property="og:image:alt" content="{{SITE_NAME}} Logo">

    <!-- TWITTER -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="{{META_TITLE}}">
    <meta name="twitter:description" content="{{META_DESC}}">
    <meta name="twitter:image" content="{{OG_IMAGE}}">
    
    <!-- ROBOTS -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    
    <!-- ASSETS -->
    <link rel="icon" href="{{FAVICON}}">
    <link rel="canonical" href="{{CANONICAL_URL}}">
    {{LOGO_PRELOAD}}
    <!-- STATIC SCHEMAS -->
    {{SCHEMA_BLOCK}}
    
    <style>html { scroll-behavior: smooth; }</style>

    <style>
        :root {
            /* --- CORE THEME VARIABLES --- */
            --brand-primary: {{THEME_BRAND_PRIMARY}};
            --brand-dark: {{THEME_BRAND_DARK}};
            --status-green: {{THEME_STATUS_GREEN}};
            --accent-gold: {{THEME_ACCENT_GOLD}};
            --bg-body: {{THEME_BG_BODY}};
            --bg-panel: {{THEME_BG_PANEL}};
            --bg-glass: {{THEME_BG_GLASS}};
            --border: {{THEME_BORDER_COLOR}};
            --text-main: {{THEME_TEXT_MAIN}};
            --text-muted: {{THEME_TEXT_MUTED}};
            
            /* --- TYPOGRAPHY & SIZING --- */
            --font-family-base: {{THEME_FONT_FAMILY_BASE}};
            --font-family-headings: {{THEME_FONT_FAMILY_HEADINGS}};
            --base-font-size: {{THEME_BASE_FONT_SIZE}}; 
            --container-max-width: {{THEME_CONTAINER_MAX_WIDTH}}; 
            --border-radius-base: {{THEME_BORDER_RADIUS_BASE}}; 
            
            /* --- HEADER LAYOUT VARS --- */
            --header-bg: {{THEME_HEADER_BG}};
            --header-border-bottom: {{THEME_HEADER_BORDER_BOTTOM}};
            --header-logo-order: {{THEME_HEADER_LOGO_ORDER}}; /* 1, 2, or 3 */
            --header-nav-order: {{THEME_HEADER_NAV_ORDER}};   /* 1, 2, or 3 */
            --header-justify: {{THEME_HEADER_JUSTIFY}};       /* space-between, center */
            
            /* --- HERO VARS --- */
            --hero-text-align: {{THEME_HERO_TEXT_ALIGN}};     /* center, left, right */
            --hero-bg-css: {{HERO_BG_CSS}}; 
            --hero-h1-color: {{THEME_HERO_H1_COLOR}};
            --hero-intro-color: {{THEME_HERO_INTRO_COLOR}};

            /* --- MATCH LAYOUT VARS --- */
            --match-row-bg: {{THEME_MATCH_ROW_BG}};
            --match-row-border: {{THEME_MATCH_ROW_BORDER}};
            --match-row-hover-transform: {{THEME_MATCH_ROW_HOVER_TRANSFORM}};
            
            /* --- FEATURED MATCH VARS --- */
            --featured-bg: {{THEME_FEATURED_BG}};
            --featured-border: {{THEME_FEATURED_BORDER}};
            
            /* --- FOOTER & SOCIALS --- */
            --footer-bg: {{THEME_FOOTER_BG_CSS}}; 
            --footer-align: {{THEME_FOOTER_ALIGN}};
            --social-pos-top: {{THEME_SOCIAL_DESKTOP_TOP}};
            --social-pos-left: {{THEME_SOCIAL_DESKTOP_LEFT}};
            
            /* --- UTILITY --- */
            --logo-image-size: {{THEME_LOGO_IMAGE_SIZE}};
            --section-logo-size: {{THEME_SECTION_LOGO_SIZE}};
            
            /* --- ANIMATION VARS --- */
            --anim-speed: 15s;
        }

        /* --- GLOBAL RESET & BASE --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: var(--font-family-base); background: var(--bg-body); color: var(--text-main); font-size: var(--base-font-size); overflow-x: hidden; padding-bottom: 80px; }
        a { text-decoration: none; color: inherit; transition: 0.2s; }
        button { cursor: pointer; border: none; font-family: inherit; }
        
        /* --- LAYOUT WRAPPER (Boxed vs Full) --- */
        .site-wrapper { width: 100%; min-height: 100vh; display: flex; flex-direction: column; }
        .site-wrapper.boxed { max-width: var(--container-max-width); margin: 0 auto; box-shadow: 0 0 50px rgba(0,0,0,0.5); border-left: 1px solid var(--border); border-right: 1px solid var(--border); }
        .container { max-width: var(--container-max-width); margin: 0 auto; padding: 20px 15px; width: 100%; }

        /* --- ANIMATION ENGINE --- */
        .anim-gradient { background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); background-size: 400% 400%; animation: gradientBG var(--anim-speed) ease infinite; }
        .anim-noise { position: relative; } 
        .anim-noise::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.05; background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E"); pointer-events: none; z-index: 0; }
        .anim-mesh { background-color: var(--bg-body); background-image: radial-gradient(at 40% 20%, hsla(28,100%,74%,1) 0px, transparent 50%), radial-gradient(at 80% 0%, hsla(189,100%,56%,1) 0px, transparent 50%), radial-gradient(at 0% 50%, hsla(355,100%,93%,1) 0px, transparent 50%); }
        .anim-lines { background: repeating-linear-gradient(45deg, var(--bg-panel), var(--bg-panel) 10px, var(--bg-body) 10px, var(--bg-body) 20px); }
        
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        /* --- HEADER (Reorderable) --- */
        header { background: var(--header-bg); border-bottom: var(--header-border-bottom); height: 60px; width: 100%; z-index: 100; backdrop-filter: blur(10px); }
        header.sticky { position: fixed; top: 0; } 
        .header-container { display: flex; align-items: center; justify-content: var(--header-justify); padding: 0 15px; height: 100%; max-width: var(--container-max-width); margin: 0 auto; }
        .logo-link { display: flex; align-items: center; gap: 10px; order: var(--header-logo-order); }
        .nav-links { display: none; gap: 20px; height: 100%; order: var(--header-nav-order); }
        .hamburger { order: 3; display: block; font-size: 1.4rem; color: var(--text-main); background: none; }
        
        @media (min-width: 900px) { 
            .nav-links { display: flex; } 
            .hamburger { display: none; } 
            body.has-sticky-header { padding-top: 60px; }
        }

        /* --- HERO --- */
        .hero { padding: 40px 15px; text-align: var(--hero-text-align); var(--hero-bg-css); position: relative; border-bottom: 1px solid var(--border); }
        .hero-content { position: relative; z-index: 2; } /* Keeps text above animations */
        
        /* --- FEATURED MATCH (New) --- */
        .featured-card { 
            background: var(--featured-bg); border: 1px solid var(--featured-border); 
            border-radius: var(--border-radius-base); padding: 20px; margin-bottom: 30px; 
            display: flex; flex-direction: column; align-items: center; gap: 15px; 
            position: relative; overflow: hidden; box-shadow: var(--card-shadow);
        }
        .f-badge { background: var(--brand-primary); color: #fff; padding: 4px 10px; border-radius: 4px; font-weight: 700; font-size: 0.8rem; text-transform: uppercase; }
        .f-teams { display: flex; align-items: center; gap: 20px; font-size: 1.2rem; font-weight: 800; font-family: var(--font-family-headings); text-align: center; width: 100%; justify-content: center; }
        .f-vs { color: var(--accent-gold); font-style: italic; }
        .f-logo { width: 50px; height: 50px; object-fit: contain; }
        
        /* --- MATCH ROWS --- */
        .match-row { 
            display: grid; align-items: center; gap: 10px; 
            background: var(--match-row-bg); border: 1px solid var(--match-row-border); 
            border-radius: var(--border-radius-base); padding: 10px; margin-bottom: 8px; 
            transition: 0.2s; position: relative; overflow: hidden;
        }
        .match-row:hover { transform: var(--match-row-hover-transform); border-color: var(--brand-primary); }
        
        /* Layout: Standard */
        .match-row.layout-standard { grid-template-columns: 50px 1fr 60px 80px; }
        /* Layout: Grid (Mobile friendly) */
        .match-row.layout-grid { grid-template-columns: 1fr 1fr; grid-template-areas: "teams teams" "meta action"; }
        
        @media (min-width: 768px) { 
            .match-row.layout-standard { grid-template-columns: 80px 1fr 100px 120px; padding: 15px 20px; } 
        }

        /* --- UTILS --- */
        .sec-head { display: flex; justify-content: space-between; align-items: flex-end; margin: 40px 0 15px 0; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .sec-title { font-size: 1.3rem; font-weight: 800; color: var(--text-main); display: flex; align-items: center; gap: 10px; margin: 0; font-family: var(--font-family-headings); }
        
        /* --- SOCIALS --- */
        .social-sidebar { position: fixed; top: var(--social-pos-top); left: var(--social-pos-left); transform: translateY(-50%); z-index: 90; display: flex; flex-direction: column; gap: 8px; padding: 10px; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 0 8px 8px 0; }
        
        /* --- FOOTER --- */
        footer { background: var(--footer-bg); padding: 60px 20px; text-align: var(--footer-align); border-top: 1px solid var(--border); }
        
        /* Rest of your existing specific styles (sys-status, badges, etc.) remain valid and inherit the variables */
        .sys-status { display: inline-flex; align-items: center; gap: 8px; padding: 5px 15px; border-radius: 50px; font-weight: 700; font-size: 0.75rem; background: rgba(34, 197, 94, 0.1); color: var(--status-green); border: 1px solid rgba(34, 197, 94, 0.2); }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; box-shadow: 0 0 10px currentColor; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        
        /* Mobile Menu */
        .mobile-menu { position: absolute; top: 60px; left: 0; width: 100%; background: var(--bg-panel); border-bottom: 1px solid var(--border); display: none; flex-direction: column; }
        .mobile-menu.active { display: flex; }
        .mobile-menu a { padding: 15px; border-bottom: 1px solid var(--border); font-weight: 600; }
    </style>
</head>
<body>
    <div class="site-wrapper {{THEME_LAYOUT_MODE}}"> <!-- Global Wrapper for Boxed/Fluid -->
        
        <div id="socialSidebar" class="social-sidebar"></div>

        <header class="{{HEADER_STICKY_CLASS}}">
            <div class="header-container">
                <a href="/" class="logo-link">{{LOGO_HTML}}</a>
                <nav class="nav-links" id="desktopNav">{{HEADER_MENU}}</nav>
                <button class="hamburger" onclick="toggleMenu()">‚ò∞</button>
            </div>
        </header>
        <div class="mobile-menu" id="mobileMenu">{{HEADER_MENU}}</div>

        <!-- HERO SECTION -->
        <div class="hero {{HERO_ANIMATION_CLASS}}">
            <div class="hero-content"> <!-- Wrapper for content over animation -->
                <div class="sys-status"><div class="dot"></div> System Status: Online</div>
                <h1>{{H1_TITLE}}</h1>
                <p class="entity-intro">{{HERO_TEXT}}</p>
                <div class="cat-scroll">{{HERO_PILLS}}</div>
            </div>
        </div>

        <main class="container">
            
            <!-- 0. FEATURED MATCH (New) -->
            <div id="featured-match-container"></div>

            <!-- 1. LIVE SECTION -->
            <div id="live-section" class="{{LIVE_ANIMATION_CLASS}}">
                <div id="live-content-wrapper" style="display:none;">
                    <div class="sec-head">
                        <h2 class="sec-title"><div class="live-dot"></div> {{TEXT_LIVE_SECTION_TITLE}}</h2>
                        <div class="sec-right-link" id="live-count"></div>
                    </div>
                    <div id="trending-list" class="match-list"></div>
                    <button id="show-more-live" class="show-more-btn" style="display:none">{{TEXT_SHOW_MORE}} ‚ñº</button>
                    <div id="hidden-live-list" class="match-list" style="display:none; margin-top:10px;"></div>
                </div>
            </div>
            
            <!-- 2. WILDCARD SECTION -->
            <div id="wildcard-container"></div>

            <!-- 3. TOP 5 UPCOMING -->
            <div id="top-upcoming-container"></div>

            <!-- 4. OTHER LISTS -->
            <div id="grouped-container"></div>
            
            <div class="seo-box" style="margin-top:40px; color:var(--text-muted); font-size:0.9rem; line-height:1.6;">{{ARTICLE_CONTENT}}</div>

            <div class="section-box" style="margin-top:50px;">
                <div class="sec-head"><h2 class="sec-title">üèÜ Popular Leagues</h2></div>
                <div class="leagues-grid">{{FOOTER_LEAGUES}}</div>
            </div>

        </main>

        <footer class="{{FOOTER_ANIMATION_CLASS}}">
            <div class="footer-grid">
                <div class="f-brand">
                    {{LOGO_HTML}}
                    <div class="f-desc">{{FOOTER_DISCLAIMER}}</div>
                </div>
                <div>
                    <div class="f-head">Quick Links</div>
                    <div class="f-links">{{FOOTER_STATIC}}</div>
                </div>
            </div>
            <div class="copyright">{{FOOTER_COPYRIGHT}}</div>
        </footer>

        <!-- MOBILE STICKY FOOTER -->
        <div id="mobileFooter" class="mobile-sticky-footer"></div>

        <button id="backToTop" class="back-to-top" onclick="window.scrollTo(0,0)">
            <svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
        </button>
    </div>

    <script>
        // JS variables for config
        const API_URL = "{{API_URL}}";
        const TARGET_COUNTRY = "{{TARGET_COUNTRY}}"; 
        const PRIORITIES = {{JS_PRIORITIES}}; 
        const SITE_DOMAIN = "https://{{DOMAIN}}";
        const RAW_LEAGUE_MAP = {{JS_LEAGUE_MAP}}; 
        const IMAGE_MAP = {{JS_IMAGE_MAP}};
        const WILDCARD_CATEGORY = "{{WILDCARD_CATEGORY}}"; // NEW: Injected by Build Script

        const SHARE_CONFIG = {
            excluded: ['dmca', 'about', 'contact', 'privacy'],
            counts: { telegram: 1240, whatsapp: 850, reddit: 340, twitter: 510 } 
        };

        const THEME_CONFIG = {{JS_THEME_CONFIG}}; 

        let teamToLeagueMap = {};
        if (RAW_LEAGUE_MAP) {
            for (const [leagueName, teams] of Object.entries(RAW_LEAGUE_MAP)) {
                if (Array.isArray(teams)) {
                    teams.forEach(slug => {
                        teamToLeagueMap[slug] = leagueName;
                    });
                }
            }
        }

        let allMatches = [];
        let scrollTimeout;

        function escapeHtml(text) {
            if (!text) return text;
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        function openMatch(matchId, type) {
            const url = `${SITE_DOMAIN}/watch/?info=${matchId}`;
            window.location.href = url;
        }

        window.addEventListener('DOMContentLoaded', () => {
            highlightActiveMenu();
            renderSocials();
            loadMatches();
        });

        window.addEventListener('scroll', () => {
            const btn = document.getElementById('backToTop');
            if(window.scrollY > 300) {
                btn.classList.add('show');
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => { btn.classList.remove('show'); }, 2000); 
            } else {
                btn.classList.remove('show');
            }
        });

        async function loadMatches() {
            try {
                let urlToFetch = API_URL;

                // 2. Safety Check: If the placeholder {{API_URL}} is still there or empty, STOP.
                // Do NOT fall back to a hardcoded URL.
                if(urlToFetch.includes("{{") || !urlToFetch) {
                    console.error("Configuration Error: API URL is missing from Admin Panel.");
                    return; 
                }

                const resMatches = await fetch(`${urlToFetch}?country=${TARGET_COUNTRY.toLowerCase()}`);
                
                if (resMatches.ok) {
                    const data = await resMatches.json();
                    
                    data.matches.forEach(m => {
                        if (!m.startTimeUnix && m.timestamp) {
                            m.startTimeUnix = new Date(m.timestamp).getTime();
                        }
                    });

                    allMatches = data.matches.filter(m => !((m.home_team === 'TBA' || !m.home_team) && (m.away_team === 'TBA' || !m.away_team)));
                    
                    const processedMatches = processMatches(allMatches);
                    renderApp(processedMatches);
                } else {
                    console.error("Failed to load matches");
                }
            } catch(e) { console.error(e); }
        }

        function escapeRegExp(string) { return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }

        function resolveLeagueData(match) {
            let apiLeague = (match.league || match.sport || "Other").trim();
            const homeName = (match.home_team || "").toUpperCase();

            for (const pKey of Object.keys(PRIORITIES)) {
                if (pKey.startsWith('_')) continue;
                const prefix = pKey.toUpperCase() + ":";
                if (homeName.startsWith(prefix)) {
                    return { name: pKey, source: "Fix" };
                }
            }

            const hSlug = slugify(match.home_team);
            const aSlug = slugify(match.away_team);
            
            if (teamToLeagueMap[hSlug] && teamToLeagueMap[aSlug] && teamToLeagueMap[hSlug] === teamToLeagueMap[aSlug]) {
                return { name: teamToLeagueMap[hSlug], source: "Map" };
            } 
            else if (teamToLeagueMap[hSlug]) {
                 return { name: teamToLeagueMap[hSlug], source: "MapHome" };
            }

            return { name: apiLeague, source: "API" };
        }

        function processMatches(matches) {
            return matches.map(m => {
                const homeSlug = slugify(m.home_team);
                const awaySlug = slugify(m.away_team);
                const resolved = resolveLeagueData(m);
                const homeClean = getCleanTeamName(m.home_team, homeSlug, resolved.name);
                const awayClean = getCleanTeamName(m.away_team, awaySlug, resolved.name);
                const score = calculateScore(m, resolved.name);

                return {
                    ...m,
                    finalLeague: resolved.name,
                    displayHome: escapeHtml(homeClean), 
                    displayAway: escapeHtml(awayClean),
                    priorityScore: score
                };
            });
        }

        function slugify(text) {
            return (text || "").toString().toLowerCase().replace(/[^\w\s-]/g, '').replace(/\s+/g, '-').replace(/^-+|-+$/g, '');
        }

        function unslugify(slug) {
            return slug.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
        }

        function getCleanTeamName(rawName, slug, resolvedLeague) {
            if (!rawName) return "TBA";
            if (rawName === "TBA" || slug === "tba") return "TBA";
            if (teamToLeagueMap[slug]) return unslugify(slug);
            if (rawName.includes(': ')) {
                return rawName.split(': ').pop().trim();
            }
            let clean = rawName.replace(/^(NHL|NBA|NFL|MLB|UFC):\s*/i, '').trim();
            return clean;
        }

        function calculateScore(m, leagueName) {
            let score = 0;
            const boostCategories = (PRIORITIES._BOOST || "").toLowerCase().split(',').map(s => s.trim()).filter(Boolean);
            const leagueLower = leagueName.toLowerCase();

            if (boostCategories.some(b => leagueLower.includes(b))) {
                score += 2000; 
            }
            if (PRIORITIES[leagueName]) {
                score += PRIORITIES[leagueName].score * 10;
            } else {
                const sport = m.sport || "General";
                if(PRIORITIES[sport]) {
                    score += PRIORITIES[sport].score; 
                }
            }
            if (m.is_live) {
                score += 5000;
                score += (m.live_viewers || 0);
            } else {
                const hoursUntil = (m.startTimeUnix - Date.now()) / 3600000;
                if (hoursUntil < 24) score += (24 - hoursUntil);
            }
            return score;
        }

        function normalizeKey(str) { return str ? str.toLowerCase().replace(/[^a-z0-9]/g, '') : ""; }

        function renderApp(matches) {
            // Hide Skeletons
            document.getElementById('live-section').style.minHeight = '0'; // Collapse if empty

            const now = Date.now();
            const oneDay = 24 * 60 * 60 * 1000;

            // Sorting
            const liveMatches = matches.filter(m => m.is_live).sort((a,b) => b.priorityScore - a.priorityScore);
            const upcomingMatches = matches.filter(m => !m.is_live).sort((a,b) => b.priorityScore - a.priorityScore);

            const shownIds = new Set();

            // --- 1. FEATURED MATCH LOGIC ---
            // If there is a live match, the #1 priority becomes Featured
            if (liveMatches.length > 0) {
                const featured = liveMatches[0];
                renderFeaturedMatch(featured);
                shownIds.add(featured.id); // Mark as shown
            }

            // --- 2. LIVE SECTION ---
            // Filter out the featured match so it doesn't duplicate
            const remainingLive = liveMatches.filter(m => !shownIds.has(m.id));
            renderLiveSection(remainingLive);

            // --- 3. WILDCARD LOGIC ---
            const isWildcardActive = WILDCARD_CATEGORY && WILDCARD_CATEGORY.length > 2 && !WILDCARD_CATEGORY.startsWith("{{");
            
            if (isWildcardActive) {
                wildcardMatches = upcomingMatches.filter(m => 
                    m.finalLeague.toLowerCase().includes(WILDCARD_CATEGORY.toLowerCase()) || 
                    (m.sport || "").toLowerCase().includes(WILDCARD_CATEGORY.toLowerCase())
                ).sort((a,b) => a.startTimeUnix - b.startTimeUnix);

                if (wildcardMatches.length > 0) {
                    const wcContainer = document.getElementById('wildcard-container');
                    wcContainer.innerHTML = ''; 
                    
                    // 1. WILDCARD TITLE LOGIC
                    // Use Admin Title OR fallback to "Prefix + Category"
                    let wcTitle = "{{TEXT_WILDCARD_TITLE}}";
                    if (!wcTitle) {
                        const prefix = "{{TEXT_SECTION_PREFIX}}".trim() || "Upcoming";
                        wcTitle = `${prefix} ${WILDCARD_CATEGORY}`;
                    }
                    
                    // Note: We pass skipPrefix=true because we manually constructed the title above
                    createSection(wcContainer, wcTitle, wildcardMatches, false, false, null, WILDCARD_CATEGORY, true);
                }
            }

            // --- TOP 5 UPCOMING LOGIC ---
            let top5Ids = new Set();
            
            if (!isWildcardActive) {
                const top24h = upcomingMatches.filter(m => (m.startTimeUnix - now) < oneDay);
                const top5Display = top24h.slice(0, 5);
                
                if (top5Display.length > 0) {
                    // 2. TOP 5 TITLE LOGIC
                    // Use Admin Title OR fallback default
                    const topTitle = "{{TEXT_TOP_UPCOMING_TITLE}}" || "Top Matches in Next 24h";
                    
                    createSection(document.getElementById('top-upcoming-container'), topTitle, top5Display, false, false, "üî•", null, true);
                    top5Display.forEach(m => top5Ids.add(m.id));
                } else {
                    document.getElementById('top-upcoming-container').innerHTML = '<div style="padding:15px;color:var(--text-muted);text-align:center;">No upcoming matches in next 24h.</div>';
                }
            } else {
                document.getElementById('top-upcoming-container').style.display = 'none';
            }

            generateDynamicSchema(liveMatches, upcomingMatches);

            // --- GROUPED SECTIONS LOGIC ---
            const wcIds = new Set(wildcardMatches.map(m => m.id));
            const remainingMatches = upcomingMatches.filter(m => 
                !wcIds.has(m.id) && 
                !top5Ids.has(m.id) && 
                (m.startTimeUnix - now) < oneDay
            );

            renderGroupedSections(remainingMatches);
        }

        // NEW FUNCTION: Render Featured Card
        function renderFeaturedMatch(m) {
            const container = document.getElementById('featured-match-container');
            if(!container) return;
            
            // Get Logos
            // (Reuse getLogo logic from createMatchRow or pass Image URLs if available in data)
            // Simplified for brevity - assumes logic exists or simple placeholders
            
            const html = `
                <div class="featured-card">
                    <div class="f-badge">üî• TOP LIVE EVENT</div>
                    <div class="f-teams">
                        <span>${m.displayHome}</span>
                        <span class="f-vs">VS</span>
                        <span>${m.displayAway}</span>
                    </div>
                    <div style="margin-top:10px; text-align:center;">
                        <button onclick="openMatch('${m.id}', 'live')" class="btn-watch" style="padding:10px 30px; font-size:1rem;">
                            WATCH LIVE NOW
                        </button>
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        function renderGroupedSections(matches) {
            const container = document.getElementById('grouped-container');
            container.innerHTML = '';

            const boostList = (PRIORITIES._BOOST || "").toLowerCase().split(',').map(s=>s.trim()).filter(Boolean);
            const HIDE_OTHERS = PRIORITIES._HIDE_OTHERS === true;

            const buckets = { boost: {}, leagues: {}, generic: {}, other: [] };

            Object.keys(PRIORITIES).forEach(key => {
                if(key.startsWith('_')) return;
                const conf = PRIORITIES[key];
                if(conf.isHidden) return;
                if(conf.isLeague) buckets.leagues[key] = [];
                else buckets.generic[key] = [];
            });

            matches.forEach(m => {
                const leagueName = m.finalLeague;
                const leagueLower = leagueName.toLowerCase();
                const sport = m.sport || "General";

                if (boostList.some(b => leagueLower.includes(b))) {
                    if (!buckets.boost[leagueName]) buckets.boost[leagueName] = [];
                    buckets.boost[leagueName].push(m);
                    return;
                }
                let placed = false;
                for (const pKey of Object.keys(buckets.leagues)) {
                    if (leagueLower.includes(pKey.toLowerCase())) {
                        buckets.leagues[pKey].push(m);
                        placed = true;
                        break;
                    }
                }
                if(placed) return;
                for (const pKey of Object.keys(buckets.generic)) {
                    if (leagueLower.includes(pKey.toLowerCase()) || sport.toLowerCase().includes(pKey.toLowerCase())) {
                        buckets.generic[pKey].push(m);
                        placed = true;
                        break;
                    }
                }
                if(placed) return;
                if(!HIDE_OTHERS) buckets.other.push(m);
            });

            Object.keys(buckets.boost).forEach(key => { if(buckets.boost[key].length) createSection(container, key, buckets.boost[key], true, true, null, key); });
            const sortedLeagues = Object.keys(buckets.leagues).sort((a,b) => PRIORITIES[b].score - PRIORITIES[a].score);
            sortedLeagues.forEach(key => { if(buckets.leagues[key].length) createSection(container, key, buckets.leagues[key], true, true, null, key); });
            const sortedSports = Object.keys(buckets.generic).sort((a,b) => PRIORITIES[b].score - PRIORITIES[a].score);
            sortedSports.forEach(key => { if(buckets.generic[key].length) createSection(container, key, buckets.generic[key], false, false, null, key); });
            if(buckets.other.length) createSection(container, "Upcoming Other Matches", buckets.other, false, false, null, null);
        }

        function renderLiveSection(matches) {
            const wrapper = document.getElementById('live-content-wrapper');
            const topList = document.getElementById('trending-list');
            const hiddenList = document.getElementById('hidden-live-list');
            const btn = document.getElementById('show-more-live');
            
            // 1. VISUAL PRIORITY LOGIC
            // We do NOT strictly hide non-wildcard matches here. 
            // Instead, we push Wildcard matches to the very top.
            let displayMatches = matches;

            if (WILDCARD_CATEGORY && WILDCARD_CATEGORY.length > 2) {
                const wLower = WILDCARD_CATEGORY.toLowerCase();
                
                // Bucket A: The Wildcard Matches
                const wcMatches = matches.filter(m => 
                    m.finalLeague.toLowerCase().includes(wLower) || 
                    (m.sport || "").toLowerCase().includes(wLower)
                );
                
                // Bucket B: Everything Else (Non-Duplicate)
                // Note: We used !includes so these are mutually exclusive
                const otherMatches = matches.filter(m => 
                    !m.finalLeague.toLowerCase().includes(wLower) && 
                    !(m.sport || "").toLowerCase().includes(wLower)
                );

                // Merge: Wildcard First + Others Second
                displayMatches = [...wcMatches, ...otherMatches];
            }

            // 2. Rendering
            if (displayMatches.length === 0) { 
                wrapper.style.display = 'none'; 
                document.getElementById('live-section').style.display = 'none';
                return; 
            }
            
            wrapper.style.display = 'block';
            topList.innerHTML = ''; hiddenList.innerHTML = ''; btn.style.display='none';
            
            // Update counter text
            document.getElementById('live-count').innerText = `‚óè ${displayMatches.length} Live Events`;
            
            // Show Top 5 (Visuals)
            displayMatches.slice(0, 5).forEach(m => topList.appendChild(createMatchRow(m, { isLive: true }, null)));
            
            // Hide the rest behind "Show More"
            if (displayMatches.length > 5) {
                displayMatches.slice(5).forEach(m => hiddenList.appendChild(createMatchRow(m, { isLive: true }, null)));
                btn.style.display = 'block'; btn.innerText = `{{TEXT_SHOW_MORE}} (${displayMatches.length - 5}) ‚ñº`;
                btn.onclick = () => { hiddenList.style.display='block'; btn.style.display='none'; };
            }
        }

        function createSection(container, title, matches, hasLink, isLeague, customIcon, sectionTitle, skipPrefix=false) {
            if(!matches || matches.length === 0) return;

            const section = document.createElement('div');
            section.style.marginBottom = '30px';
            
            let linkHtml = '';
            if (!skipPrefix && PRIORITIES[title] && PRIORITIES[title].hasLink) {
                const slug = normalizeKey(title);
                linkHtml = `<a href="/${slug}-streams/" class="sec-right-link">{{TEXT_SECTION_LINK}} ></a>`;
            }

            let iconHtml = customIcon ? `<span style="font-size:1.2rem; margin-right:8px;">${customIcon}</span>` : '';
            if (IMAGE_MAP.leagues && IMAGE_MAP.leagues[title]) {
                const logoUrl = IMAGE_MAP.leagues[title];
                iconHtml = `<img src="${logoUrl}" class="sec-logo" alt="${title}" fetchpriority="low">`;
            } else if (!customIcon) {
                iconHtml = `<span style="font-size:1.2rem; margin-right:8px;">${getSportIcon(title)}</span>`;
            }

            // 3. PREFIX LOGIC
            // Apply prefix only if we are NOT skipping it (standard sections) and a prefix exists
            let displayTitle = title;
            const prefix = "{{TEXT_SECTION_PREFIX}}".trim();
            if (!skipPrefix && prefix) {
                displayTitle = `${prefix} ${title}`;
            }

            section.innerHTML = `
                <div class="sec-head">
                    <h2 class="sec-title">${iconHtml} ${displayTitle}</h2>
                    ${linkHtml}
                </div>`;
            
            const list = document.createElement('div');
            matches.sort((a, b) => a.startTimeUnix - b.startTimeUnix).forEach(m => {
                list.appendChild(createMatchRow(m, { isLive: false }, sectionTitle));
            });
            section.appendChild(list);
            container.appendChild(section);
        }
        function formatMatchTime(unix) {
    if (!unix || isNaN(unix)) return { time: "--:--", date: "Unknown" };
    
    // STRICT CONTROL: Check Admin Panel Target Country
    const isUK = (typeof TARGET_COUNTRY !== 'undefined' && TARGET_COUNTRY === 'UK');
    
    // Force Timezone based on Target
    const timeZone = isUK ? 'Europe/London' : 'America/New_York';
    const suffix = isUK ? ' GMT' : ' ET';
    
    try {
        const date = new Date(unix);
        
        // Format time strictly to the target timezone
        const timeStr = new Intl.DateTimeFormat('en-US', {
            hour: 'numeric', 
            minute: '2-digit', 
            hour12: true, 
            timeZone: timeZone // Forces the timezone calculation
        }).format(date);
        
        // Format date strictly to the target timezone
        const dateStr = new Intl.DateTimeFormat('en-US', {
            month: 'short', 
            day: 'numeric', 
            timeZone: timeZone
        }).format(date);
        
        return { time: timeStr + suffix, date: dateStr };
    } catch (e) {
        return { time: "--:--", date: "Invalid Date" };
    }
}

        function createMatchRow(m, context, sectionTitle) {
            const div = document.createElement('div');
            div.className = m.is_live ? 'match-row live' : 'match-row';
            
            let timeCol;
            if (m.is_live) {
                timeCol = `<span class="live-txt">LIVE</span><span class="time-sub">${m.status_text || "Now"}</span>`;
            } else { 
                const ft = formatMatchTime(m.startTimeUnix);
                timeCol = `<span class="time-main">${ft.time}</span><span class="time-sub">${ft.date}</span>`; 
            }
            
            const getLogo = (name) => {
                if (IMAGE_MAP.teams && IMAGE_MAP.teams[name]) {
                    const p = IMAGE_MAP.teams[name];
                    const full = p.startsWith('/') ? p : '/' + p;
                    return `<div class="logo-box"><img src="${full}" class="t-img" alt="${name}" loading="lazy" width="20" height="20"></div>`;
                }
                return `<div class="logo-box"><span class="t-logo" style="background:${getColor(name.charAt(0))}">${name.charAt(0)}</span></div>`;
            };
            
            let teamsHtml = '';
            const isSingle = (m.displayAway === 'TBA');
            
            if (isSingle) {
                teamsHtml = `<div class="team-name">${getLogo(m.displayHome)} ${m.displayHome}</div>`;
            } else {
                teamsHtml += `<div class="team-name">${getLogo(m.displayHome)} ${m.displayHome}</div>`;
                teamsHtml += `<div class="team-name">${getLogo(m.displayAway)} ${m.displayAway}</div>`;
            }
            
            let tagText = m.finalLeague;
            if (sectionTitle && m.finalLeague === sectionTitle) {
                tagText = m.sport || "General";
            }
            
            let metaHtml = '';
            if (m.is_live) {
                const v = m.live_viewers || 0;
                let vText = "‚ö° Stable"; 
                if (v > 5000) vText = `üëÄ ${(v/1000).toFixed(1)}k üî•`;
                else if (v >= 1000) vText = `üëÄ ${(v/1000).toFixed(1)}k üìà`;
                metaHtml = `<div class="meta-top">${vText}</div>`;
            } else {
                 metaHtml = `
                    <div style="display:flex; flex-direction:column; align-items:flex-end;">
                        <span style="font-size:0.55rem; color:var(--text-muted); font-weight:700; text-transform:uppercase; margin-bottom:2px;">Starts in</span>
                        <span class="meta-top" style="color:var(--accent-gold); font-size:0.75rem;">${m.status_text}</span>
                    </div>`;
            }

            let actionHtml = '';
            const infoLink = `${SITE_DOMAIN}/watch/?info=${m.id}`;
            const copyBtn = `<button class="btn-copy-link" onclick="copyText('${infoLink}')"><svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg> Link</button>`;

            if (m.is_live) {
                actionHtml = `<button onclick="openMatch('${m.id}', 'live')" class="btn-watch" title="Watch ${m.displayHome}">{{TEXT_WATCH_BTN}} <span class="hd-badge">{{TEXT_HD_BADGE}}</span></button>`;
            } else {
                const now = Date.now();
                const start = m.startTimeUnix || now;
                const diffMin = (start - now) / 60000;
                
                if (diffMin <= 30) {
                     actionHtml = `<button onclick="openMatch('${m.id}', 'info')" class="btn-watch">{{TEXT_WATCH_BTN}} <span class="hd-badge">{{TEXT_HD_BADGE}}</span></button>` + copyBtn;
                } else {
                     actionHtml = `<button onclick="setNotify(this)" class="btn-notify">üîî Notify</button>` + copyBtn;
                }
            }
            
            div.innerHTML = `<div class="col-time">${timeCol}</div><div class="teams-wrapper"><div class="league-tag">${tagText.toUpperCase()}</div>${teamsHtml}</div><div class="col-meta">${metaHtml}</div><div class="col-action">${actionHtml}</div>`;
            return div;
        }

        function generateDynamicSchema(liveList, upcomingList) {
            const now = Date.now();
            const twentyMin = 20 * 60 * 1000;
            const oneDay = 24 * 60 * 60 * 1000;

            const existing = document.getElementById('dynamic-schema-script');
            if (existing) existing.remove();

            const metaImg = document.querySelector('meta[property="og:image"]');
            const mainImage = metaImg ? metaImg.content : `${SITE_DOMAIN}/assets/logo.png`;

            const INDIVIDUAL_SPORTS = ['ufc', 'mma', 'boxing', 'tennis', 'golf', 'f1', 'motorsport', 'fighting', 'nascar', 'wwe'];
            const isIndividual = (leagueName) => {
                const lower = (leagueName || "").toLowerCase();
                return INDIVIDUAL_SPORTS.some(s => lower.includes(s));
            };

            // --- WILDCARD SCHEMA LOGIC ---
            let targetLive = liveList;
            let targetUpcoming = upcomingList;

            if (WILDCARD_CATEGORY && WILDCARD_CATEGORY.length > 2) {
                const wLower = WILDCARD_CATEGORY.toLowerCase();
                // STRICT FILTERING FOR SCHEMA
                targetLive = liveList.filter(m => 
                    m.finalLeague.toLowerCase().includes(wLower) || (m.sport||"").toLowerCase().includes(wLower)
                );
                targetUpcoming = upcomingList.filter(m => 
                    m.finalLeague.toLowerCase().includes(wLower) || (m.sport||"").toLowerCase().includes(wLower)
                );
                // Note: For Wildcard, we do NOT limit to 15 items, effectively grabbing "all" as requested.
                // However, we still filter matches that have passed start time in upcoming list logic below.
            } else {
                // Standard Logic: Limit items if no wildcard
                targetLive = targetLive.slice(0, 5);
                targetUpcoming = targetUpcoming.filter(m => (m.startTimeUnix - now) < oneDay).slice(0, 15);
            }

            // Valid Live Logic (Strict Duration)
            const validLive = targetLive.filter(m => {
                if (!m.startTimeUnix) return false;
                const duration = (m.sport_duration || 120) * 60 * 1000;
                const cutoffTime = m.startTimeUnix + duration - twentyMin;
                return now < cutoffTime;
            });

            // Valid Upcoming Logic (Strict Future)
            const validUpcoming = targetUpcoming.filter(m => {
                if (!m.startTimeUnix) return false;
                return (m.startTimeUnix - now) > 0; // Strictly future
            });

            const allItems = [...validLive, ...validUpcoming];
            if (allItems.length === 0) return;

            const listItems = allItems.map((m, index) => {
                const isLiveItem = validLive.includes(m);
                const evtStatus = isLiveItem ? "https://schema.org/EventLive" : "https://schema.org/EventScheduled";
                const entityType = isIndividual(m.finalLeague) ? "Person" : "SportsTeam";
                const isSingle = !m.displayAway || m.displayAway === 'TBA';

                let logoA = undefined, logoB = undefined;
                if (isSingle) {
                    if (IMAGE_MAP.teams && IMAGE_MAP.teams[m.displayHome]) logoA = `${SITE_DOMAIN}${IMAGE_MAP.teams[m.displayHome]}`;
                } else {
                    if (IMAGE_MAP.teams && IMAGE_MAP.teams[m.displayHome] && IMAGE_MAP.teams[m.displayAway]) {
                        logoA = `${SITE_DOMAIN}${IMAGE_MAP.teams[m.displayHome]}`;
                        logoB = `${SITE_DOMAIN}${IMAGE_MAP.teams[m.displayAway]}`;
                    }
                }

                const schemaItem = {
                    "@type": "SportsEvent",
                    "startDate": new Date(m.startTimeUnix).toISOString(),
                    "eventStatus": evtStatus,
                    "eventAttendanceMode": "https://schema.org/OnlineEventAttendanceMode",
                    "url": `${SITE_DOMAIN}/watch/?info=${m.id}`,
                    "image": [ mainImage ],
                    "organizer": { "@id": `${SITE_DOMAIN}/#organization` },
                    "offers": {
                        "@type": "Offer",
                        "price": "0",
                        "priceCurrency": "USD",
                        "availability": isLiveItem ? "https://schema.org/InStock" : "https://schema.org/PreOrder",
                        "url": `${SITE_DOMAIN}/watch/?info=${m.id}`
                    }
                };

                if (isSingle) {
                    schemaItem.name = m.displayHome; 
                    schemaItem.description = `Watch ${m.displayHome} live stream. ${m.finalLeague}.`;
                    schemaItem.competitor = [{ "@type": entityType, "name": m.displayHome, "logo": logoA }];
                } else {
                    schemaItem.name = `${m.displayHome} vs ${m.displayAway}`;
                    schemaItem.description = `Watch ${m.displayHome} vs ${m.displayAway} live stream. ${m.finalLeague}.`;
                    schemaItem.homeTeam = { "@type": entityType, "name": m.displayHome, "logo": logoA };
                    schemaItem.awayTeam = { "@type": entityType, "name": m.displayAway, "logo": logoB };
                }

                return { "@type": "ListItem", "position": index + 1, "item": schemaItem };
            });

            const schema = {
                "@context": "https://schema.org",
                "@type": "ItemList",
                "@id": `${SITE_DOMAIN}/#matchlist`,
                "name": WILDCARD_CATEGORY ? `${WILDCARD_CATEGORY} Schedule` : "Live & Upcoming Sports Schedule",
                "itemListElement": listItems
            };

            const script = document.createElement('script');
            script.id = 'dynamic-schema-script';
            script.type = 'application/ld+json';
            script.text = JSON.stringify(schema);
            document.head.appendChild(script);
        }

        function renderSocials() {
            const currentSlug = window.location.pathname.replace(/\//g, '');
            if(SHARE_CONFIG.excluded.includes(currentSlug)) return;

            const makeUrl = (p) => {
                const u = encodeURIComponent(SITE_DOMAIN);
                if(p==='telegram') return `https://t.me/share/url?url=${u}`;
                if(p==='whatsapp') return `https://api.whatsapp.com/send?text=${u}`;
                if(p==='reddit') return `https://www.reddit.com/submit?url=${u}`;
                if(p==='twitter') return `https://twitter.com/intent/tweet?url=${u}`;
                return null;
            };

            const icons = {
                telegram: '<svg viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.47-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.28L19.84 4c.75-.28 1.4.52 1.16 1.76l-2.8 13.2c-.2.9-1.09.9-1.8.6l-5.45-4.06-2.6 2.5c-.3.3-.55.55-1.1.55l.45-3.6z"/></svg>',
                whatsapp: '<svg viewBox="0 0 24 24"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91c0 1.75.46 3.46 1.33 4.97L2 22l5.25-1.38a9.86 9.86 0 004.79 1.22h.01c5.46 0 9.91-4.45 9.91-9.91C21.96 6.45 17.51 2 12.04 2zm4.43-6.03c-.24-.12-1.41-.7-1.63-.78-.22-.08-.38-.12-.54.12-.16.24-.62.78-.76.94-.14.16-.28.18-.52.06-.24-.12-1.02-.38-1.94-1.2-.72-.64-1.2-1.44-1.34-1.68-.14-.24-.01-.37.11-.49.11-.11.24-.28.36-.42.12-.14.16-.24.24-.4.08-.16.04-.3-.02-.42-.06-.12-.54-1.3-.74-1.78-.2-.48-.4-.42-.54-.42h-.46c-.16 0-.42.06-.64.3C4.33 8.6 3.5 9.2 3.5 10.38c0 1.18.86 2.32.98 2.48.12.16 1.7 2.6 4.12 3.65.58.25 1.03.4 1.38.51.58.18 1.1.15 1.52.09.46-.07 1.41-.58 1.61-1.14.2-.56.2-1.04.14-1.14-.06-.1-.22-.16-.46-.28z"/></svg>',
                reddit: '<svg viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.22 14.11c-.13.26-.35.45-.6.54-.25.09-.52.1-.78.01-.8-.28-1.76-.43-2.77-.43s-1.97.15-2.77.43c-.26.09-.53.08-.78-.01-.25-.09-.47-.28-.6-.54-.15-.3-.19-.64-.11-.96.08-.32.28-.59.56-.75.9-.53 2.05-.83 3.28-.88l.66-3.11 2.16.46c.04-.2.15-.38.31-.51s.36-.2.55-.17c.2.03.38.15.51.31.13.16.2.36.17.55l-2.16-.46-.66 3.11c1.23.05 2.38.35 3.28.88.28.16.48.43.56.75.08.32.04.66-.11.96zM12 11.25c-.97 0-1.75.78-1.75 1.75s.78 1.75 1.75 1.75 1.75-.78 1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75zm-3.25-2.5c0-.69.56-1.25 1.25-1.25s1.25.56 1.25 1.25-.56 1.25-1.25 1.25-1.25-.56-1.25-1.25zm6.5 0c0-.69.56-1.25 1.25-1.25s1.25.56 1.25 1.25-.56 1.25-1.25 1.25-1.25-.56-1.25-1.25z"/></svg>',
                twitter: '<svg viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/></svg>',
                copy: '<svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>'
            };

            let html = '';
            ['telegram', 'whatsapp', 'reddit', 'twitter', 'copy'].forEach(p => {
                const count = SHARE_CONFIG.counts[p] ? formatCount(SHARE_CONFIG.counts[p]) : '';
                const onclick = p === 'copy' ? `copyText('${SITE_DOMAIN}')` : `window.open('${makeUrl(p)}', '_blank')`;
                html += `<div class="social-btn ${p}" onclick="${onclick}">${icons[p]}<span class="s-count">${count}</span></div>`;
            });

            if(document.getElementById('socialSidebar')) document.getElementById('socialSidebar').innerHTML = html;
            if(document.getElementById('mobileFooter')) document.getElementById('mobileFooter').innerHTML = html;
        }

        function copyText(text) {
            navigator.clipboard.writeText(text);
            const old = document.querySelector('.copy-toast');
            if (old) old.remove();
            const t = document.createElement('div');
            t.className = 'copy-toast'; t.innerText = 'Link copied ‚úì';
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 1600);
        }

        function formatCount(num) {
            if (!num) return '';
            return num >= 1000 ? (num / 1000).toFixed(1) + 'k' : num;
        }

        function toTitleCase(str) { return str.replace(/\w\S*/g, txt => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()); }
        function getSportIcon(n) { n=(n||"").toLowerCase(); if(n.includes('soccer')||n.includes('premier')) return '‚öΩ'; if(n.includes('basket')||n.includes('nba')) return 'üèÄ'; if(n.includes('football')||n.includes('nfl')) return 'üèà'; if(n.includes('baseball')||n.includes('mlb')) return '‚öæ'; if(n.includes('fight')||n.includes('ufc')||n.includes('box')||n.includes('mma')) return 'ü•ä'; if(n.includes('motor')||n.includes('f1')) return 'üèéÔ∏è'; return 'üèÜ'; }
        function getColor(char) { const c = ['#e53935','#d81b60','#8e24aa','#5e35b1','#3949ab','#1e88e5','#039be5','#00897b','#43a047','#7cb342','#c0ca33','#fdd835','#fb8c00']; return c[(char||'A').charCodeAt(0) % c.length]; }
        
        function highlightActiveMenu() {
            const path = window.location.pathname;
            document.querySelectorAll('.nav-links a, .mobile-menu a').forEach(link => {
                if(link.getAttribute('href') === path) link.classList.add('active');
            });
        }
        
        function toggleMenu() { document.getElementById('mobileMenu').classList.toggle('active'); }
        function setNotify(btn) {
            // Just update visual state, no copying, no toast.
            btn.classList.add('active'); 
            btn.innerHTML = '‚úì Set'; 
            btn.disabled = true;
        }
    </script>
</body>
</html>
