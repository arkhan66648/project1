<!DOCTYPE html>
<html lang="en">
<head>
    <!-- SEO & METADATA -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{META_TITLE}}</title>
    <meta name="description" content="{{META_DESC}}">
    {{META_KEYWORDS}}
    <meta name="theme-color" content="{{THEME_META_COLOR}}">

    <!-- OPEN GRAPH -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{CANONICAL_URL}}">
    <meta property="og:site_name" content="{{SITE_NAME}}">
    <meta property="og:title" content="{{META_TITLE}}">
    <meta property="og:description" content="{{META_DESC}}">
    <meta property="og:image" content="{{OG_IMAGE}}">
    <meta property="og:image:type" content="{{OG_MIME}}">
    
    <meta name="robots" content="index, follow">
    <link rel="icon" href="{{FAVICON}}">
    <link rel="canonical" href="{{CANONICAL_URL}}">
    {{LOGO_PRELOAD}}
    
    <!-- SCHEMA -->
    {{SCHEMA_BLOCK}}
    
    <style>html { scroll-behavior: smooth; }</style>

    <style>
        :root {
            /* --- DYNAMIC THEME VARIABLES --- */
            --brand-primary: {{THEME_BRAND_PRIMARY}};
            --brand-dark: {{THEME_BRAND_DARK}};
            --status-green: {{THEME_STATUS_GREEN}};
            --accent-gold: {{THEME_ACCENT_GOLD}};
            --bg-body: {{THEME_BG_BODY}};
            --bg-panel: {{THEME_BG_PANEL}};
            --text-main: {{THEME_TEXT_MAIN}};
            --text-muted: {{THEME_TEXT_MUTED}};
            --border: {{THEME_BORDER_COLOR}};
            
            --font-family-base: {{THEME_FONT_FAMILY_BASE}};
            --font-family-headings: {{THEME_FONT_FAMILY_HEADINGS}};
            --base-font-size: {{THEME_BASE_FONT_SIZE}};
            --container-max-width: {{THEME_CONTAINER_MAX_WIDTH}}; 
            --header-max-width: {{THEME_HEADER_MAX_WIDTH}};
            --border-radius-base: {{THEME_BORDER_RADIUS_BASE}}; 
            --button-border-radius: {{THEME_BUTTON_BORDER_RADIUS}};
            
            /* HEADER */
            --header-bg: {{THEME_HEADER_BG}};
            --header-text-color: {{THEME_HEADER_TEXT_COLOR}};
            --header-link-active-color: {{THEME_HEADER_LINK_ACTIVE_COLOR}};
            --header-link-hover-color: {{THEME_HEADER_LINK_HOVER_COLOR}};
            --header-border-bottom: {{THEME_HEADER_BORDER_BOTTOM}};
            --logo-text-p1-color: {{THEME_LOGO_P1_COLOR}};
            --logo-text-p2-color: {{THEME_LOGO_P2_COLOR}};
            --logo-image-size: {{THEME_LOGO_IMAGE_SIZE}};

            /* HERO */
            --hero-h1-color: {{THEME_HERO_H1_COLOR}};
            --hero-intro-color: {{THEME_HERO_INTRO_COLOR}};
            
            /* MATCH ROWS */
            --match-row-bg: {{THEME_MATCH_ROW_BG}};
            --match-row-border: {{THEME_MATCH_ROW_BORDER}};
            --match-row-hover-bg: {{THEME_MATCH_ROW_HOVER_BG}};
            --match-row-hover-border: {{THEME_MATCH_ROW_HOVER_BORDER}};
            --match-row-live-border-left: {{THEME_MATCH_ROW_LIVE_BORDER_LEFT}};
            --match-row-live-bg-start: {{THEME_MATCH_ROW_LIVE_BG_START}};
            --match-row-live-bg-end: {{THEME_MATCH_ROW_LIVE_BG_END}};
            
            --match-row-time-main-color: {{THEME_MATCH_ROW_TIME_MAIN_COLOR}};
            --match-row-time-sub-color: {{THEME_MATCH_ROW_TIME_SUB_COLOR}};
            --match-row-team-name-color: {{THEME_MATCH_ROW_TEAM_NAME_COLOR}};
            --match-row-live-text-color: {{THEME_MATCH_ROW_LIVE_TEXT_COLOR}};
            --match-row-league-tag-color: {{THEME_MATCH_ROW_LEAGUE_TAG_COLOR}};
            
            --match-row-btn-watch-bg: {{THEME_MATCH_ROW_BTN_WATCH_BG}};
            --match-row-btn-watch-text: {{THEME_MATCH_ROW_BTN_WATCH_TEXT}};
            --match-row-btn-watch-hover-bg: {{THEME_MATCH_ROW_BTN_WATCH_HOVER_BG}};
            
            --match-row-hd-badge-bg: {{THEME_MATCH_ROW_HD_BADGE_BG}};
            --match-row-hd-badge-border: {{THEME_MATCH_ROW_HD_BADGE_BORDER}};
            --match-row-hd-badge-text: {{THEME_MATCH_ROW_HD_BADGE_TEXT}};

            /* FOOTER */
            --footer-bg-start: {{THEME_FOOTER_BG_START}};
            --footer-bg-end: {{THEME_FOOTER_BG_END}};
            --footer-heading-color: {{THEME_FOOTER_HEADING_COLOR}};
            --footer-link-color: {{THEME_FOOTER_LINK_COLOR}};
            --footer-link-hover-color: {{THEME_FOOTER_LINK_HOVER_COLOR}};
            --footer-desc-color: {{THEME_FOOTER_DESC_COLOR}};
            --footer-copyright-color: {{THEME_FOOTER_COPYRIGHT_COLOR}};
            --footer-border-top: {{THEME_FOOTER_BORDER_TOP}};

            /* SOCIALS & EXTRAS */
            --social-sidebar-bg: {{THEME_SOCIAL_SIDEBAR_BG}};
            --social-sidebar-border: {{THEME_SOCIAL_SIDEBAR_BORDER}};
            --social-btn-bg: {{THEME_SOCIAL_BTN_BG}};
            --social-btn-border: {{THEME_SOCIAL_BTN_BORDER}};
            --social-btn-color: {{THEME_SOCIAL_BTN_COLOR}};
            --social-btn-hover-bg: {{THEME_SOCIAL_BTN_HOVER_BG}};
            --social-count-color: {{THEME_SOCIAL_COUNT_COLOR}};
            
            --mobile-footer-bg: {{THEME_MOBILE_FOOTER_BG}};
            --mobile-footer-border-top: {{THEME_MOBILE_FOOTER_BORDER_TOP}};
            --copy-toast-bg: {{THEME_COPY_TOAST_BG}};
            
            --back-to-top-bg: {{THEME_BACK_TO_TOP_BG}};
            --back-to-top-icon-color: {{THEME_BACK_TO_TOP_ICON_COLOR}};
            --back-to-top-radius: {{THEME_BACK_TO_TOP_RADIUS}};
            
            --section-logo-size: {{THEME_SECTION_LOGO_SIZE}};
            --sys-status-bg: {{THEME_SYS_STATUS_BG}};
            --sys-status-text: {{THEME_SYS_STATUS_TEXT}};
            
            --league-card-bg: {{THEME_LEAGUE_CARD_BG}};
            --league-card-border: {{THEME_LEAGUE_CARD_BORDER}};
            --league-card-text: {{THEME_LEAGUE_CARD_TEXT}};
            --league-card-hover-bg: {{THEME_LEAGUE_CARD_HOVER_BG}};

            /* FIXED HEIGHTS */
            --row-h-mob: 76px;
            --row-h-desk: 96px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: var(--font-family-base); background: var(--bg-body); color: var(--text-main); font-size: var(--base-font-size); padding-bottom: 80px; }
        a { text-decoration: none; color: inherit; transition: 0.2s; }
        button { cursor: pointer; border: none; font-family: inherit; }
        
        /* HEADER */
        header { background: var(--header-bg); border-bottom: var(--header-border-bottom); height: 60px; width: 100%; position: relative; z-index: 100; backdrop-filter: blur(10px); }
        @media (min-width: 900px) { header { position: fixed; top: 0; } body { padding-top: 60px; } }
        
        .header-container { max-width: var(--header-max-width); margin: 0 auto; height: 100%; padding: 0 15px; display: flex; align-items: center; }
        .h-layout-standard .header-container { justify-content: space-between; }
        .h-layout-center .header-container { justify-content: center; }
        
        .logo-link { display: flex; align-items: center; gap: 10px; }
        .logo-img { height: var(--logo-image-size); width: var(--logo-image-size); border-radius: var(--border-radius-base); object-fit: cover; }
        .logo-text { font-size: 1.4rem; font-weight: 900; font-style: italic; letter-spacing: -1px; text-transform: uppercase; line-height: 1; color: var(--logo-text-p1-color); }
        .logo-text span { color: var(--logo-text-p2-color); }

        .nav-links { display: none; gap: 20px; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; color: var(--header-text-color); }
        .nav-links a:hover { color: var(--header-link-hover-color); }
        .hamburger { display: block; font-size: 1.4rem; color: var(--header-text-color); background: none; }
        @media (min-width: 900px) { 
            .h-layout-standard .nav-links { display: flex; } 
            .h-layout-standard .hamburger { display: none; } 
        }
        .mobile-menu { position: absolute; top: 60px; left: 0; width: 100%; background: var(--bg-panel); border-bottom: var(--header-border-bottom); display: none; flex-direction: column; z-index: 99; }
        .mobile-menu.active { display: flex; }
        .mobile-menu a { padding: 15px 20px; border-bottom: 1px solid var(--border); font-weight: 600; color: var(--text-muted); }

        /* HERO SECTION */
        .hero-section { {{HERO_OUTER_STYLE}} }
        .hero-inner {
            {{HERO_INNER_STYLE}}
            display: flex; flex-direction: column; 
            text-align: {{THEME_HERO_TEXT_ALIGN}}; 
            align-items: {{THEME_HERO_ALIGN_ITEMS}};
        }
        .sys-status { display: inline-flex; align-items: center; gap: 8px; background: var(--sys-status-bg); border: 1px solid var(--border); padding: 5px 14px; border-radius: 20px; margin-bottom: 15px; font-size: 0.75rem; font-weight: 700; color: var(--sys-status-text); }
        .hero-inner h1 { margin: 0 0 15px 0; font-size: 2rem; color: var(--hero-h1-color); font-family: var(--font-family-headings); font-weight: 800; line-height:1.2; }
        .entity-intro { margin: 0; color: var(--hero-intro-color); max-width: 700px; font-size: 0.95rem; line-height: 1.6; margin: {{THEME_HERO_INTRO_MARGIN}}; }

        /* CONTENT */
        .container { max-width: var(--container-max-width); margin: 0 auto; padding: 20px 15px; min-height: 60vh; }
        
        .sec-head { display: flex; align-items: center; gap: 10px; margin: 40px 0 15px 0; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        #upcoming-container .sec-head { border-bottom: {{THEME_SEC_BORDER_UPCOMING}}; }
        
        .sec-title { font-size: 1.2rem; font-weight: 800; margin: 0; text-transform: uppercase; color: var(--text-main); display: flex; align-items: center; gap: 10px; font-family: var(--font-family-headings); }
        .live-dot { width: 8px; height: 8px; background: var(--brand-primary); border-radius: 50%; box-shadow: 0 0 10px var(--brand-primary); }

        /* MATCH ROW */
        .match-row { 
            display: grid; grid-template-columns: 45px 1fr 50px 75px; align-items: center; gap: 8px; 
            background: var(--match-row-bg); border: 1px solid var(--match-row-border); 
            border-radius: var(--border-radius-base); padding: 10px 8px 5px 8px; margin-bottom: 8px; 
            position: relative; transition: 0.2s; height: var(--row-h-mob); overflow: hidden;
        }
        .match-row:hover { border-color: var(--match-row-hover-border); background: var(--match-row-hover-bg); transform: translateY(-2px); }
        .match-row.live { border-left: var(--match-row-live-border-left); background: linear-gradient(90deg, var(--match-row-live-bg-start) 0%, var(--match-row-live-bg-end) 100%); }
        @media (min-width: 768px) { .match-row { grid-template-columns: 80px 1fr 100px 110px; padding: 15px 20px 10px 20px; gap: 20px; height: var(--row-h-desk); } }
        
        .col-time { text-align: center; display: flex; flex-direction: column; justify-content: center; gap: 2px; }
        .time-main { font-size: 0.75rem; font-weight: 700; color: var(--match-row-time-main-color); }
        .time-sub { font-size: 0.6rem; color: var(--match-row-time-sub-color); }
        .live-txt { color: var(--match-row-live-text-color); font-weight: 900; animation: blink 1.5s infinite; font-size: 0.65rem; }

        .teams-wrapper { display: flex; flex-direction: column; gap: 3px; justify-content: center; height:100%; }
        .league-tag { font-size: 0.6rem; color: var(--match-row-league-tag-color); font-weight: 700; text-transform: uppercase; }
        .team-name { font-size: 0.75rem; font-weight: 600; color: var(--match-row-team-name-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: flex; align-items: center; gap: 6px; }
        @media (min-width: 768px) { .team-name { font-size: 0.95rem; } }

        .logo-box { width: 20px; height: 20px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; position: relative; margin-right: 4px; }
        .t-img { width: 100%; height: 100%; object-fit: contain; }
        .t-logo { width: 100%; height: 100%; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 9px; font-weight: 900; color: #fff; position: absolute; top: 0; left: 0; }

        .col-meta { display: flex; flex-direction: column; align-items: flex-end; justify-content: center; }
        .meta-top { font-size: 0.7rem; font-weight: 700; color: var(--accent-gold); white-space: nowrap; }

        .col-action { margin-left: auto; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; }
        .btn-watch { 
            background: var(--match-row-btn-watch-bg); color: var(--match-row-btn-watch-text); 
            font-size: 0.65rem; font-weight: 800; padding: 6px 10px; 
            border-radius: var(--button-border-radius); width: 100%; text-transform: uppercase; 
            display:flex; align-items:center; justify-content:center; gap:5px; height: 26px; transition: 0.2s;
        }
        .btn-watch:hover { background: var(--match-row-btn-watch-hover-bg); transform: scale(1.05); }
        .hd-badge { background: var(--match-row-hd-badge-bg); padding: 1px 4px; border-radius: 3px; font-size: 0.55rem; border: 1px solid var(--match-row-hd-badge-border); color: var(--match-row-hd-badge-text); }

        /* ENTITY STACKING ARTICLE */
        .seo-article { margin-top: 50px; padding-top: 30px; border-top: 1px solid var(--border); color: var(--text-muted); line-height: 1.7; font-size: 0.9rem; }
        .seo-article h1 { font-size: 1.5rem; color: var(--text-main); margin-bottom: 15px; }
        .seo-article h2 { font-size: 1.2rem; color: var(--text-main); margin: 25px 0 10px 0; }
        .seo-article h3 { font-size: 1.1rem; color: var(--text-main); margin: 20px 0 10px 0; }
        .seo-article a { color: var(--brand-primary); text-decoration: underline; }

        /* FOOTER & EXTRAS */
        .leagues-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px; margin-top: 15px; }
        .league-card { background: var(--league-card-bg); border: 1px solid var(--league-card-border); padding: 10px 15px; border-radius: var(--border-radius-base); display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .league-card:hover { border-color: var(--league-card-hover-border); background: var(--league-card-hover-bg); transform: translateY(-2px); }
        .league-card span { font-size: 0.8rem; font-weight: 700; color: var(--league-card-text); }
        
        footer { background: linear-gradient(180deg, var(--footer-bg-start) 0%, var(--footer-bg-end) 100%); border-top: var(--footer-border-top); padding: 60px 20px 30px 20px; margin-top: 60px; }
        .footer-grid { display: grid; grid-template-columns: {{THEME_FOOTER_GRID_COLUMNS}}; gap: 40px; max-width: var(--container-max-width); margin: 0 auto; text-align: {{THEME_FOOTER_TEXT_ALIGN_MOBILE}}; }
        @media(min-width: 768px) { .footer-grid { grid-template-columns: {{THEME_FOOTER_GRID_COLUMNS_DESKTOP}}; text-align: {{THEME_FOOTER_TEXT_ALIGN_DESKTOP}}; } }
        .f-brand h2 { margin: 0 0 15px 0; font-style: italic; text-transform: uppercase; color: {{THEME_FOOTER_BRAND_COLOR}}; letter-spacing: -1px; }
        .f-desc { color: var(--footer-desc-color); font-size: 0.85rem; line-height: 1.6; }
        .f-links { display: flex; flex-direction: column; gap: 12px; }
        .f-link { color: var(--footer-link-color); font-size: 0.9rem; font-weight: 500; transition: 0.2s; }
        .f-link:hover { color: var(--footer-link-hover-color); transform: var(--footer-link-hover-transform); }
        .copyright { margin-top: 50px; border-top: 1px solid var(--border); padding-top: 25px; text-align: center; font-size: 0.75rem; color: var(--footer-copyright-color); }

        /* SOCIALS & BTT */
        .social-sidebar { position: fixed; left: 0; top: var(--social-desktop-top); transform: translateY(-50%) scale(var(--social-desktop-scale)); z-index: 90; display: flex; flex-direction: column; gap: 8px; background: var(--social-sidebar-bg); border: 1px solid var(--social-sidebar-border); border-left: none; padding: 12px 8px; border-radius: 0 6px 6px 0; backdrop-filter: blur(5px); }
        .social-btn { width: 44px; padding: 6px 0; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 3px; color: var(--social-btn-color); background: var(--social-btn-bg); border: 1px solid var(--social-btn-border); border-radius: 4px; transition: 0.2s; cursor: pointer; }
        .social-btn svg { width: 20px; height: 20px; fill: currentColor; }
        .social-btn:hover { background: var(--social-btn-hover-bg); transform: translateX(5px); }
        .s-count { font-size: 0.65rem; font-weight: 700; color: var(--social-count-color); }
        @media (max-width: 1024px) { .social-sidebar { display: none; } }

        .mobile-sticky-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--mobile-footer-bg); backdrop-filter: blur(10px); border-top: var(--mobile-footer-border-top); padding: 0 5px; display: none; justify-content: space-between; align-items: center; z-index: 900; height: var(--mobile-footer-height); box-shadow: var(--mobile-footer-shadow); }
        .mobile-sticky-footer .social-btn { border: none; flex: 1; height: 100%; border-radius: 0; transform: none !important; background: transparent; }
        .mobile-sticky-footer .social-btn:active { background: {{THEME_MOBILE_FOOTER_BTN_ACTIVE_BG}}; }
        @media (max-width: 1024px) { .mobile-sticky-footer { display: flex; } }

        .copy-toast { position: fixed; left: 50%; bottom: 90px; transform: translateX(-50%); background: var(--copy-toast-bg); border: 1px solid var(--border); color: #fff; padding: 8px 14px; font-size: 0.75rem; border-radius: 6px; z-index: 9999; opacity: 0; animation: fadeToast 1.6s ease forwards; }
        @keyframes fadeToast { 0% { opacity: 0; transform: translate(-50%, 10px); } 20% { opacity: 1; transform: translate(-50%, 0); } 80% { opacity: 1; } 100% { opacity: 0; } }

        .back-to-top { position: fixed; bottom: 80px; right: 20px; background: var(--back-to-top-bg); width: var(--back-to-top-size); height: var(--back-to-top-size); border-radius: var(--back-to-top-radius); display: flex; align-items: center; justify-content: center; color: var(--back-to-top-icon-color); cursor: pointer; opacity: 0; visibility: hidden; transition: 0.3s; z-index: 90; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .back-to-top.show { opacity: 1; visibility: visible; }
        .back-to-top svg { width: 24px; height: 24px; fill: currentColor; }
        @media (min-width: 768px) { .back-to-top { bottom: 30px; } }

        @keyframes blink { 0%, 100% {opacity:1;} 50% {opacity:0.4;} }
    </style>
</head>
<body>

    <div id="socialSidebar" class="social-sidebar"></div>

    <header class="{{HEADER_CLASSES}}">
        <div class="header-container">
            <a href="/" class="logo-link">{{LOGO_HTML}}</a>
            <nav class="nav-links" id="desktopNav">{{HEADER_MENU}}</nav>
            <button class="hamburger" onclick="toggleMenu()">‚ò∞</button>
        </div>
    </header>
    <div class="mobile-menu" id="mobileMenu">{{HEADER_MENU}}</div>

    <!-- HERO SECTION -->
    <div class="hero-section">
        <div class="hero-inner">
            <div class="sys-status"><div class="live-dot"></div> {{THEME_TEXT_SYS_STATUS}}</div>
            <h1>{{H1_TITLE}}</h1>
            <p class="entity-intro">{{HERO_TEXT}}</p> 
        </div>
    </div>

    <main class="container">
        
        <!-- LIVE SECTION -->
        <div id="live-section" style="display:none;">
            <div class="sec-head">
                <h2 class="sec-title"><div class="live-dot"></div> {{TEXT_LIVE_SECTION_TITLE}}</h2>
            </div>
            <div id="live-list"></div>
        </div>

        <!-- UPCOMING SECTION -->
        <div id="upcoming-container">
            <div class="sec-head">
                <h2 class="sec-title">
                    <span style="font-size:1.2rem;">üìÖ</span> 
                    {{TEXT_UPCOMING_TITLE}}
                </h2>
            </div>
            <!-- FIXED: Added style to ensure visibility and prevent collapse -->
            <div id="schedule-list" style="min-height:100px; display:block;">
                <div style="padding:20px; text-align:center; color:var(--text-muted);" id="loading-msg">Loading schedule...</div>
            </div>
        </div>

        <!-- ARTICLE -->
        <article class="seo-article">
            {{LEAGUE_ARTICLE}}
        </article>

        <!-- FOOTER LEAGUES -->
        <div class="section-box" style="margin-top:50px;">
            <div class="sec-head"><h2 class="sec-title">üèÜ Popular Leagues</h2></div>
            <div class="leagues-grid">{{FOOTER_LEAGUES}}</div>
        </div>

    </main>

    <footer>
        <div class="footer-grid">
            <div class="f-brand">
                {{LOGO_HTML}}
                <div class="f-desc">{{FOOTER_DISCLAIMER}}</div>
            </div>
            <div>
                <div class="f-head" style="margin-bottom:15px;color:var(--footer-heading-color);font-weight:700;">Quick Links</div>
                <div class="f-links">{{FOOTER_STATIC}}</div>
            </div>
        </div>
        <div class="copyright">{{FOOTER_COPYRIGHT}}</div>
    </footer>

    <!-- MOBILE STICKY FOOTER -->
    <div id="mobileFooter" class="mobile-sticky-footer"></div>

    <button id="backToTop" class="back-to-top" onclick="window.scrollTo(0,0)">
        <svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
    </button>

    <script>
        const API_URL = "{{API_URL}}";
        const TARGET_COUNTRY = "{{TARGET_COUNTRY}}"; 
        const SITE_DOMAIN = "https://{{DOMAIN}}";
        const PAGE_FILTER = "{{PAGE_FILTER}}"; 

        const TEAM_TO_LEAGUE = {{JS_LEAGUE_MAP}}; 
        const IMAGE_MAP = {{JS_IMAGE_MAP}};
        const THEME_CONFIG = {{JS_THEME_CONFIG}};
        const SHARE_CONFIG = { excluded: [], counts: {} }; 
        const PRIORITIES = {{JS_PRIORITIES}}; 

        const NAME_FIXES = {
            "icehockey": "Ice Hockey", "fieldhockey": "Field Hockey",
            "tabletennis": "Table Tennis", "americanfootball": "American Football",
            "australianfootball": "AFL", "basketball": "Basketball",
            "football": "Soccer", "soccer": "Soccer", "baseball": "Baseball",
            "fighting": "Fighting", "mma": "MMA", "boxing": "Boxing",
            "motorsport": "Motorsport", "golf": "Golf"
        };

        window.addEventListener('DOMContentLoaded', () => {
            highlightActiveMenu();
            setTimeout(renderSocials, 3000);
            loadMatches();
        });

        window.addEventListener('scroll', () => {
            const btn = document.getElementById('backToTop');
            if(window.scrollY > 300) btn.classList.add('show');
            else btn.classList.remove('show');
        });

        function resolveLeagueData(match) {
            const hSlug = slugify(match.home_team);
            const aSlug = slugify(match.away_team);

            // A. Auto-Fix: Priority Prefix Check
            const homeUpper = (match.home_team || "").toUpperCase();
            // SAFETY CHECK: Ensure PRIORITIES is an object
            if (PRIORITIES && typeof PRIORITIES === 'object') {
                for (const pKey of Object.keys(PRIORITIES)) {
                    if (pKey.startsWith('_')) continue;
                    const prefix = pKey.toUpperCase() + ":";
                    if (homeUpper.startsWith(prefix)) {
                        return { name: pKey, source: "Fix" };
                    }
                }
            }

            // B. Strict Map Check
            if (TEAM_TO_LEAGUE && TEAM_TO_LEAGUE[hSlug] && TEAM_TO_LEAGUE[aSlug] && TEAM_TO_LEAGUE[hSlug] === TEAM_TO_LEAGUE[aSlug]) {
                return { name: TEAM_TO_LEAGUE[hSlug], source: "Map" };
            }
            if (TEAM_TO_LEAGUE && TEAM_TO_LEAGUE[hSlug]) return { name: TEAM_TO_LEAGUE[hSlug], source: "MapHome" };
            
            // C. API Fallback
            let apiName = (match.league || match.sport || "Other").trim();
            const lowerApi = apiName.toLowerCase().replace(/\s/g, '');
            if(NAME_FIXES[lowerApi]) apiName = NAME_FIXES[lowerApi];
            return { name: apiName, source: "API" };
        }

        async function loadMatches() {
            try {
                const loadingEl = document.getElementById('loading-msg');
                
                // 1. Check API URL Config
                if(!API_URL || API_URL.includes("{{")) {
                    if(loadingEl) loadingEl.innerText = "Error: API URL not configured.";
                    return;
                }

                const res = await fetch(`${API_URL}?country=${TARGET_COUNTRY.toLowerCase()}`);
                if (!res.ok) {
                    if(loadingEl) loadingEl.innerText = "Error loading matches.";
                    return;
                }
                
                const data = await res.json();
                
                // 2. Validate Data
                if(!data || !data.matches) {
                    if(loadingEl) loadingEl.innerText = "No match data available.";
                    return;
                }

                const matches = [];
                const len = data.matches.length;
                const filterLower = PAGE_FILTER.toLowerCase();

                for(let i=0; i<len; i++) {
                    const m = data.matches[i];
                    if((m.home_team === 'TBA' || !m.home_team) && (m.away_team === 'TBA' || !m.away_team)) continue;
                    
                    if (!m.startTimeUnix && m.timestamp) m.startTimeUnix = new Date(m.timestamp).getTime();

                    const resolved = resolveLeagueData(m);
                    const mLeague = (m.league || "").toLowerCase();
                    const mSport = (m.sport || "").toLowerCase();
                    const resolvedLower = resolved.name.toLowerCase();

                    // CHECK 1: Exact Name Match (Preferred)
                    let matchFound = resolvedLower === filterLower;

                    // CHECK 2: Fuzzy Containment (Backup)
                    if (!matchFound) {
                        if (resolvedLower.includes(filterLower) || mLeague.includes(filterLower) || mSport.includes(filterLower)) {
                            matchFound = true;
                        }
                    }

                    if (matchFound) {
                        const homeSlug = slugify(m.home_team);
                        const awaySlug = slugify(m.away_team);
                        
                        matches.push({
                            ...m,
                            displayHome: escapeHtml(getCleanTeamName(m.home_team, homeSlug, resolved.name)),
                            displayAway: escapeHtml(getCleanTeamName(m.away_team, awaySlug, resolved.name)),
                            finalLeague: resolved.name
                        });
                    }
                }
                renderApp(matches);
            } catch(e) { 
                console.error(e); 
                const loadingEl = document.getElementById('loading-msg');
                if(loadingEl) loadingEl.innerText = "Failed to load schedule.";
            }
        }

        function renderApp(matches) {
            const liveList = document.getElementById('live-list');
            const schedList = document.getElementById('schedule-list');
            const liveSec = document.getElementById('live-section');

            matches.sort((a,b) => a.startTimeUnix - b.startTimeUnix);

            const liveFrag = document.createDocumentFragment();
            const schedFrag = document.createDocumentFragment();
            let liveCount = 0;

            matches.forEach(m => {
                if (m.is_live) {
                    liveFrag.appendChild(createRow(m));
                    liveCount++;
                } else {
                    schedFrag.appendChild(createRow(m));
                }
            });

            if (liveCount > 0) {
                liveList.innerHTML = '';
                liveList.appendChild(liveFrag);
                liveSec.style.display = 'block';
            }

            schedList.innerHTML = '';
            if (schedFrag.childElementCount > 0) {
                schedList.appendChild(schedFrag);
            } else {
                schedList.innerHTML = `<div style="text-align:center; padding:40px; color:var(--text-muted);">No upcoming ${PAGE_FILTER} matches scheduled.</div>`;
            }
            
            // Generate Schema
            if(window.generateDynamicSchema) generateDynamicSchema(matches.filter(m=>m.is_live), matches.filter(m=>!m.is_live));
        }

        function createRow(m) {
            const div = document.createElement('div');
            div.className = m.is_live ? 'match-row live' : 'match-row';
            
            let timeCol;
            if (m.is_live) {
                timeCol = `<span class="live-txt">LIVE</span><span class="time-sub">${m.status_text || "Now"}</span>`;
            } else { 
                const ft = formatMatchTime(m.startTimeUnix);
                timeCol = `<span class="time-main">${ft.time}</span><span class="time-sub">${ft.date}</span>`; 
            }

            const getLogo = (name) => {
                if (IMAGE_MAP.teams && IMAGE_MAP.teams[name]) {
                    const p = IMAGE_MAP.teams[name];
                    const full = p.startsWith('/') ? p : '/' + p;
                    return `<div class="logo-box"><img src="${full}" class="t-img" alt="${name}" loading="lazy" width="20" height="20"></div>`;
                }
                const c = ['#e53935','#d81b60','#8e24aa','#5e35b1','#3949ab','#1e88e5','#039be5','#00897b','#43a047','#7cb342','#c0ca33','#fdd835','#fb8c00'][(name.charCodeAt(0)||0)%13];
                return `<div class="logo-box"><span class="t-logo" style="background:${c}">${name.charAt(0)}</span></div>`;
            };

            let teamsHtml = '';
            const isSingle = (m.displayAway === 'TBA');
            if (isSingle) {
                teamsHtml = `<div class="team-name">${getLogo(m.displayHome)} ${m.displayHome}</div>`;
            } else {
                teamsHtml += `<div class="team-name">${getLogo(m.displayHome)} ${m.displayHome}</div>`;
                teamsHtml += `<div class="team-name">${getLogo(m.displayAway)} ${m.displayAway}</div>`;
            }

            let metaHtml = '';
            if (m.is_live) {
                const v = m.live_viewers || 0;
                let vText = v > 5000 ? `üëÄ ${(v/1000).toFixed(1)}k üî•` : (v >= 1000 ? `üëÄ ${(v/1000).toFixed(1)}k üìà` : "‚ö° Stable");
                metaHtml = `<div class="meta-top">${vText}</div>`;
            } else {
                 metaHtml = `<div style="display:flex; flex-direction:column; align-items:flex-end;"><span style="font-size:0.55rem; color:var(--text-muted); font-weight:700; text-transform:uppercase; margin-bottom:2px;">Starts in</span><span class="meta-top" style="color:var(--accent-gold); font-size:0.75rem;">${m.status_text}</span></div>`;
            }

            let actionHtml = '';
            const link = `${SITE_DOMAIN}/watch/?info=${m.id}`;
            const copyBtn = `<button class="btn-copy-link" onclick="copyText('${link}')" style="background:none;border:none;color:var(--match-row-btn-copy-link-color, #64748b);font-size:0.65rem;font-weight:700;cursor:pointer;margin-top:5px;display:flex;align-items:center;gap:4px;justify-content:center;">Link</button>`;

            if (m.is_live) {
                actionHtml = `<button onclick="window.location.href='${link}'" class="btn-watch">{{TEXT_WATCH_BTN}} <span class="hd-badge">{{TEXT_HD_BADGE}}</span></button>`;
            } else {
                const start = m.startTimeUnix || Date.now();
                if ((start - Date.now()) / 60000 <= 30) actionHtml = `<button onclick="window.location.href='${link}'" class="btn-watch">{{TEXT_WATCH_BTN}} <span class="hd-badge">{{TEXT_HD_BADGE}}</span></button>` + copyBtn;
                else actionHtml = `<button onclick="setNotify(this)" class="btn-notify" style="background:var(--match-row-btn-notify-bg, transparent);border:1px solid var(--match-row-btn-notify-border, #333);color:var(--match-row-btn-notify-text, #999);padding:4px 8px;border-radius:4px;font-size:0.65rem;width:100%;font-weight:700;">üîî Notify</button>` + copyBtn;
            }
            
            div.innerHTML = `<div class="col-time">${timeCol}</div><div class="teams-wrapper"><div class="league-tag">${m.finalLeague.toUpperCase()}</div>${teamsHtml}</div><div class="col-meta">${metaHtml}</div><div class="col-action">${actionHtml}</div>`;
            return div;
        }

        // --- UTILS ---
        function slugify(text) { return (text || "").toString().toLowerCase().replace(/[^\w\s-]/g, '').replace(/\s+/g, '-').replace(/^-+|-+$/g, ''); }
        function unslugify(slug) { return slug.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' '); }
        function escapeHtml(text) { if (!text) return text; return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;"); }
        function copyText(text) { navigator.clipboard.writeText(text); const t = document.createElement('div'); t.className = 'copy-toast'; t.innerText = 'Link copied ‚úì'; document.body.appendChild(t); setTimeout(() => t.remove(), 1600); }
        function highlightActiveMenu() { const path = window.location.pathname; document.querySelectorAll('.nav-links a, .mobile-menu a').forEach(link => { if(link.getAttribute('href') === path) link.classList.add('active'); }); }
        function toggleMenu() { document.getElementById('mobileMenu').classList.toggle('active'); }
        function setNotify(btn) { btn.style.borderColor = "#22c55e"; btn.style.color = "#fff"; btn.style.background = "#22c55e"; btn.innerText = "‚úì Set"; btn.disabled = true; }

        function getCleanTeamName(rawName, slug, resolvedLeague) {
            if (!rawName || rawName === "TBA" || slug === "tba") return "TBA";
            if (TEAM_TO_LEAGUE && TEAM_TO_LEAGUE[slug]) return unslugify(slug);
            let clean = rawName;
            if (resolvedLeague) {
                try {
                    const safeLeague = resolvedLeague.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    const regex = new RegExp(`^${safeLeague}:\\s*`, 'i');
                    clean = clean.replace(regex, '');
                } catch(e) {}
            }
            return clean.replace(/^(NHL|NBA|NFL|MLB|UFC):\s*/i, '').trim();
        }

        function formatMatchTime(unix) {
            if (!unix || isNaN(unix)) return { time: "--:--", date: "Unknown" };
            const isUK = (typeof TARGET_COUNTRY !== 'undefined' && TARGET_COUNTRY === 'UK');
            const timeZone = isUK ? 'Europe/London' : 'America/New_York';
            const suffix = isUK ? ' GMT' : ' ET';
            try {
                const d = new Date(unix);
                const t = new Intl.DateTimeFormat('en-US', {hour: 'numeric', minute: '2-digit', hour12: true, timeZone}).format(d);
                const dt = new Intl.DateTimeFormat('en-US', {month: 'short', day: 'numeric', timeZone}).format(d);
                return { time: t + suffix, date: dt };
            } catch (e) { return { time: "--:--", date: "Invalid" }; }
        }

        function renderSocials() {
            const currentSlug = window.location.pathname.replace(/\//g, '');
            if(SHARE_CONFIG.excluded.includes(currentSlug)) return;
            const makeUrl = (p) => {
                const u = encodeURIComponent(SITE_DOMAIN);
                if(p==='telegram') return `https://t.me/share/url?url=${u}`;
                if(p==='whatsapp') return `https://api.whatsapp.com/send?text=${u}`;
                if(p==='reddit') return `https://www.reddit.com/submit?url=${u}`;
                if(p==='twitter') return `https://twitter.com/intent/tweet?url=${u}`;
                return null;
            };
            const icons = { telegram: '<svg viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.47-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.28L19.84 4c.75-.28 1.4.52 1.16 1.76l-2.8 13.2c-.2.9-1.09.9-1.8.6l-5.45-4.06-2.6 2.5c-.3.3-.55.55-1.1.55l.45-3.6z"/></svg>', whatsapp: '<svg viewBox="0 0 24 24"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91c0 1.75.46 3.46 1.33 4.97L2 22l5.25-1.38a9.86 9.86 0 004.79 1.22h.01c5.46 0 9.91-4.45 9.91-9.91C21.96 6.45 17.51 2 12.04 2zm4.43-6.03c-.24-.12-1.41-.7-1.63-.78-.22-.08-.38-.12-.54.12-.16.24-.62.78-.76.94-.14.16-.28.18-.52.06-.24-.12-1.02-.38-1.94-1.2-.72-.64-1.2-1.44-1.34-1.68-.14-.24-.01-.37.11-.49.11-.11.24-.28.36-.42.12-.14.16-.24.24-.4.08-.16.04-.3-.02-.42-.06-.12-.54-1.3-.74-1.78-.2-.48-.4-.42-.54-.42h-.46c-.16 0-.42.06-.64.3C4.33 8.6 3.5 9.2 3.5 10.38c0 1.18.86 2.32.98 2.48.12.16 1.7 2.6 4.12 3.65.58.25 1.03.4 1.38.51.58.18 1.1.15 1.52.09.46-.07 1.41-.58 1.61-1.14.2-.56.2-1.04.14-1.14-.06-.1-.22-.16-.46-.28z"/></svg>', reddit: '<svg viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.22 14.11c-.13.26-.35.45-.6.54-.25.09-.52.1-.78.01-.8-.28-1.76-.43-2.77-.43s-1.97.15-2.77.43c-.26.09-.53.08-.78-.01-.25-.09-.47-.28-.6-.54-.15-.3-.19-.64-.11-.96.08-.32.28-.59.56-.75.9-.53 2.05-.83 3.28-.88l.66-3.11 2.16.46c.04-.2.15-.38.31-.51s.36-.2.55-.17c.2.03.38.15.51.31.13.16.2.36.17.55l-2.16-.46-.66 3.11c1.23.05 2.38.35 3.28.88.28.16.48.43.56.75.08.32.04.66-.11.96zM12 11.25c-.97 0-1.75.78-1.75 1.75s.78 1.75 1.75 1.75 1.75-.78 1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75-.78-1.75-1.75-1.75zm-3.25-2.5c0-.69.56-1.25 1.25-1.25s1.25.56 1.25 1.25-.56 1.25-1.25 1.25-1.25-.56-1.25-1.25 1.25-1.25-.56-1.25-1.25zm6.5 0c0-.69.56-1.25 1.25-1.25s1.25.56 1.25 1.25-.56 1.25-1.25 1.25-1.25-.56-1.25-1.25z"/></svg>', twitter: '<svg viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/></svg>', copy: '<svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>' };

            let html = '';
            ['telegram', 'whatsapp', 'reddit', 'twitter', 'copy'].forEach(p => {
                const count = SHARE_CONFIG.counts[p] ? ((n)=>(n>=1000?(n/1000).toFixed(1)+'k':n))(SHARE_CONFIG.counts[p]) : '';
                const onclick = p === 'copy' ? `copyText('${SITE_DOMAIN}')` : `window.open('${makeUrl(p)}', '_blank')`;
                html += `<div class="social-btn ${p}" onclick="${onclick}">${icons[p]}<span class="s-count">${count}</span></div>`;
            });
            if(document.getElementById('socialSidebar')) document.getElementById('socialSidebar').innerHTML = html;
            if(document.getElementById('mobileFooter')) document.getElementById('mobileFooter').innerHTML = html;
        }

        function generateDynamicSchema(liveList, upcomingList) {
            const allItems = [...liveList, ...upcomingList].slice(0, 20);
            if (allItems.length === 0) return;
            const mainImage = (document.querySelector('meta[property="og:image"]') || {}).content || `${SITE_DOMAIN}/assets/logo.png`;
            const listItems = allItems.map((m, index) => {
                const isLive = m.is_live;
                const schemaItem = {
                    "@type": "SportsEvent", "startDate": new Date(m.startTimeUnix).toISOString(),
                    "eventStatus": isLive ? "https://schema.org/EventLive" : "https://schema.org/EventScheduled",
                    "eventAttendanceMode": "https://schema.org/OnlineEventAttendanceMode",
                    "url": `${SITE_DOMAIN}/watch/?info=${m.id}`, "image": [ mainImage ],
                    "organizer": { "@id": `${SITE_DOMAIN}/#organization` },
                    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD", "availability": isLive ? "https://schema.org/InStock" : "https://schema.org/PreOrder", "url": `${SITE_DOMAIN}/watch/?info=${m.id}` },
                    "name": `${m.displayHome} vs ${m.displayAway}`,
                    "description": `Watch ${m.displayHome} vs ${m.displayAway} live. ${m.finalLeague} stream.`
                };
                schemaItem.homeTeam = { "@type": "SportsTeam", "name": m.displayHome };
                schemaItem.awayTeam = { "@type": "SportsTeam", "name": m.displayAway };
                return { "@type": "ListItem", "position": index + 1, "item": schemaItem };
            });
            const schema = { "@context": "https://schema.org", "@type": "ItemList", "@id": `${window.location.href}#events`, "name": `Upcoming ${PAGE_FILTER} Schedule`, "itemListElement": listItems };
            const script = document.createElement('script'); script.type = 'application/ld+json'; script.text = JSON.stringify(schema); document.head.appendChild(script);
        }
    </script>
</body>
</html>
